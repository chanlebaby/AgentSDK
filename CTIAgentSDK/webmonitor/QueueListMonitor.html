<!DOCTYPE html>
<html>
  <head>
  	<title>队列监控</title>
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
	<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache"> 
	<META HTTP-EQUIV="Expires" CONTENT="0"> 
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width" />
	<link href="../images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    <!--框架必需start-->
    <link href="../skins/CallCenterui-framework.css" rel="stylesheet" />
    <script src="../plugins/jquery/jquery-1.8.2.min.js"></script>
    <script src="../plugins/CallCenterui-framework.js"></script>
    <!--框架必需end-->
    <!--jqgrid表格组件start-->
    <script src="../plugins/jqgrid/jquery-ui-custom.min.js"></script>
    <script src="../plugins/jqgrid/grid.locale-cn.js"></script>
    <link href="../plugins/jqgrid/css/jqgrid.css" rel="stylesheet" />
    <script src="../plugins/jqgrid/jqGrid.js"></script>
    <script src="../plugins/jqgrid/grid.setcolumns.js"></script>
    <!--表格组件end-->
    <!--树形组件start-->
    <link href="../plugins/tree/tree.css" rel="stylesheet" />
    <!--树形组件end-->
    <!--框架工具JS组件start-->
    <script src="../plugins/CallCenterui-utils.js"></script>
    <!--框架工具JS组件end-->
    <!--引入弹窗组件start-->
    <link href="../plugins/artDialog4/skins/default.css?4.1.7" rel="stylesheet" />
    <script src="../plugins/artDialog4/jquery.artDialog.source.js" type="text/javascript"></script>
	<script src="../plugins/artDialog4/plugins/iframeTools.source.js" type="text/javascript"></script> 
	<!--引入弹窗组件end-->
    <!--右键菜单组件start-->
    <script src="../plugins/jquery/jquery.contextmenu.r2.js"></script>
    <!--右键菜单组件end-->
    <!--布局组件start-->
    <!-- <script src="../plugins/layout/splitter.js"></script> -->
    <link href="../plugins/splitter/jquery.splitter.css" rel="stylesheet" />
    <script src="../plugins/splitter/jquery.splitter.js" type="text/javascript"></script>
    <!--布局组件end-->
    
    <!-- CTI相关组件 start -->
    <script type="text/javascript">
    	window['_OcxCore_rootPath'] = (function() {
    	    //var strFullPath = window.document.location.href;
    	    var strPath = window.document.location.pathname;
    	    /* var pos = strFullPath.indexOf(strPath);
    	    var prePath = strFullPath.substring(0, pos);
    	    var postPath = strPath.substring(0, strPath.substr(1).indexOf('/') + 1);
    	    if(postPath != undefined && postPath != null && postPath.indexOf('/demoweb')>-1)
    	    	return (prePath + postPath); //如果发布IIS，有虚假目录用用这句
    	    else
    	    	return (prePath);
    	     */
    	    strPath = strPath.replace(/\\/g, '/');
    	    strPath = strPath.lastIndexOf('/') < 0 ? '.' : strPath.substring(0, strPath.lastIndexOf('/'));
    	    strPath = strPath.lastIndexOf('/CTIAgentSDK') < 0 ? strPath : strPath.substring(0, strPath.lastIndexOf('/CTIAgentSDK'));
    	    
    	    return strPath;
    	})();
    	window['_OcxCore_path'] = window['_OcxCore_rootPath'];
    </script>
    <script src="../core/Common.js?version=2.0.0" type="text/javascript"></script>
	<script src="../core/DialogUtil_artDialog4.js?version=2.0.0" type="text/javascript"></script>
	
	<script src="../core/model/CTIAgentModel.js?version=2.0.0" type="text/javascript"></script>
	<script src="../core/ctimonitor/CtiMonitorMain.js?version=2.0.0" type="text/javascript"></script>
	
    <!-- CTI相关组件 end -->
    
	<script type="text/javascript">
	
		var artApi = art.dialog.open.api,openerW = window.opener;
		var _QueueDatas = new OcxCore.Map();//队列列表
		var _SeatDatas = new OcxCore.Map();//坐席列表
		var seatMonitorWindows = new OcxCore.Map();//坐席监控窗口列表
		var warningRuleData = new OcxCore.Map();//预警规则列表
		var GroupId = "";//当前选中的技能ID
    	var GroupName = "";  //当前选中的技能名称
    	var showSeatMode = 1;//如何显示技能下的坐席，1显示技能下的坐席并集，2 显示交集
	    $(document).ready(function () {
	    	resizeU();
	    	$(window).resize(resizeU);
	        function resizeU() {
	        	 var divkuangW = $(window).width();
	        	 var divkuangH = $(window).height();
	             
	             $("#queueGrid_Panel").height(divkuangH - 183);
	        }
	         //加载队列监控表格
		    GetQueueMonitorGrid();
	         
		  	//自应高度
            $(window).resize(function () {
            	var divkuangW = $(window).width();
	        	 var divkuangH = $(window).height();
	        	 
                $("#queueGridTable").setGridHeight(divkuangH - 183);
	             
                $("#queueGridTable").setGridWidth(divkuangW-2); 
                
            });
		  	
	        /* $("#grid_View .UserCard").live("click", function() {
	        	var seatExtNum = $(this).attr("id").toString().replace("seat_","");
	        	if(!openerW.OcxCore.Session.IsCheckin())
	        	{
	        		
	        	}
	        	else if(openerW.OcxCore.Session.getCTIAgentData().getCTIMonitorStatus() == openerW.OcxCore.Enums.CTIMonitorStatusFlag.INITSYSTEM.getIndex())
	        	{
	        		if (!!$(this).hasClass("selected")) {
	                    $(this).removeClass("selected");
	                } else {
	                	$("#grid_View .selected").removeClass("selected");
	                    $(this).addClass("selected");
	                }
	        	}
	        	else if (seatExtNum == openerW.OcxCore.Session.getCTIAgentData().getCTIMonitorExtNumber())
	        	{
	        		if (!$(this).hasClass("selected")) {
	                    $("#grid_View .selected").removeClass("selected");
	                    $(this).addClass("selected");
	                }
	        	}
			}); */
	        
			$("#SeatGroupList li").live("click", function () {
	            if (!$(this).attr('disabled')) {
	                if (!!$(this).hasClass("selected")) {
	                    $(this).removeClass("selected");
	                    $(this).find('a').removeClass("a_selected");
	                } else {
	                    $(this).addClass("selected").siblings("li");
	                    $(this).find('a').addClass("a_selected");
	                }
	            }
	        });
 	        //自定义复选框 全选/反选
	        $("#CheckButton").click(function () {
	            if (!!$(this).hasClass("checkAllOff")) {
	                $(this).attr('title', '反选');
	                $(this).text('反选');
	                $(this).attr('class', 'checkAllOn');
	                $('.sys_spec_text li').addClass('selected');
	                $('.sys_spec_text li a').addClass('a_selected');
	            } else {
	                $(this).attr('title', '全选');
	                $(this).text('全选');
	                $(this).attr('class', 'checkAllOff');
	                $('.sys_spec_text li').removeClass('selected');
	                $('.sys_spec_text li a').removeClass('a_selected');
	            }
	        });
	        //初始化OcxCore.Session会话事件绑定
			InitCTISessionBind();
	    });
	    
	    /**
		*初始化OcxCore.Session会话事件绑定
		*/
		function InitCTISessionBind()
		{
			window.onbeforeunload = function(event){
			    event = event || window.event;
			    var isNotCloseWin = false;
			    if(seatMonitorWindows != null && seatMonitorWindows.size()>0)
			    {
			    	//判断是否还有未关闭的监控窗口
                    seatMonitorWindows.each(function(key,value,index){
                    	try
                    	{
                    		var singleWin = value;
                        	if(singleWin && singleWin.open && !singleWin.closed)
                            { 
                        		isNotCloseWin = true;
                            }
                    	}
                    	catch(e)
                    	{
                    		
                    	}
                    });
			    }
			    if(isNotCloseWin)
			    {
			    	event.returnValue = "离开本页面将关闭所有监控窗口，确认离开?";
			    }
			}
	    	window.onunload =  function(){
	    		try
            	{
           			//停止队列监控
           			stopQueueMonitor();
            		//停止心跳连接
                	OcxCore.Session.StopHeartBeat();
            		
                	//关闭所有监控窗口
                    seatMonitorWindows.each(function(key,value,index){
                    	try
                    	{
                    		var singleWin = value;
                        	if(singleWin && singleWin.open && !singleWin.closed)
                            { 
                        		singleWin.close();
                            }
                    	}
                    	catch(e)
                    	{
                    		
                    	}
                    });
            	}
            	catch(e2)
            	{
            		
            	}
	    	}
			
			//服务停止后回调函数
			OcxCore.Session.bind("onStopService",function(stopType,data){
				if(stopType == "LoginExpired")
				{
					OcxCore.Log.debug("调用了服务停止后回调函数:"+stopType);
				}
			});
			
			//主页注册通知事件监听
	 		if(mainPageNotify != undefined)
	        {
	        	var funApi = {
	        			
	        	};
	        	funApi.OnNotify = new OcxCore.Delegate();
	        	funApi.OnNotify.Attach(mainPageNotify);
	        	OcxCore.Session.GetGlobal("WindowManagement").Add(funApi);
	        }
			
			//心跳连接状态变化回调函数
			OcxCore.Session.bind("onConnectStateChange",function(ConnectState,wsObj){
				//ConnectState 0 连接关闭 1已连接 2重连中     , wsObj 心跳连接对象
				var ConnectStateStr = ConnectState == 1 ? "已连接": ConnectState == 2 ? "重连中": "连接关闭";
				OcxCore.Log.debug("调用了心跳连接状态变化回调函数,心跳连接状态状态:"+ConnectStateStr);
				
				if(ConnectState == 1)
				{
					//开始队列监控并加载队列列表和坐席列表
					//windowload();
					var postData = {
						SessionId:OcxCore.Session.getSessionId(),
						UserName:OcxCore.Session.getUserName(),
						UserCode:OcxCore.Session.getUserCode(),
						UserId:OcxCore.Session.getUserId(),
						CompanyId:OcxCore.Session.getCompanyId()
					};
					
					//加载监控配置信息
					CtiMonitorCommandFun.CommonActionWS("LoadMonitorInfo","", postData,function(data1){
			    		OcxCore.Utility.ShowLoading(false);
			    		
			    		OcxCore.Log.info("加载监控配置信息:"+OcxCore.Utility.RenderJson(data1));
			    		if(data1.WarningRuleData != undefined && data1.WarningRuleData != null)
			    		{
			    			LoadWarningRuleList(data1.WarningRuleData);
			    		}
			    		//加载队列列表和坐席列表
			    		windowload(true);
			    	},function(ex){
			    		OcxCore.Utility.ShowLoading(false);
			    		if(ex.Message != undefined && ex.Message != "") OcxCore.Utility.ShowTip(ex.Message, 1);
			    	});
				}
			});
			
			if(openerW.loadCtiMonitorUserInfo != undefined) 
			{
				openerW.loadCtiMonitorUserInfo(function(data){
					if(data.SessionId == undefined || data.SessionId == null || data.SessionId == "")
					{
						data.SessionId = OcxCore.Utility.GetUUID().replace(/-/g, "").toUpperCase();
					}
					//登录基本信息
					OcxCore.Session.setSessionId(data.SessionId);//会话ID 可以使用会话Session的ID值
					//OcxCore.Session.setUserId(data.UserId);//用户ID
					OcxCore.Session.setUserName(data.UserName);//用户账号
					OcxCore.Session.setUserCode(data.UserCode);//用户工号 四到五位整型数字
					//OcxCore.Session.setRealName(data.RealName);//用户姓名
					//OcxCore.Session.setGender(data.Gender);//性别  男   女
					OcxCore.Session.setCompanyId(data.CompanyId);//所在公司ID
					
					//配置信息
					OcxCore.Session.setLogLevel(data.LogLevel);//显示日志级别TRACE,DEBUG,INFO,WARN,ERROR,FATAL
					//OcxCore.Session.setHideMiddlePhone(data.HideMiddlePhone);//是否加密显示主被叫号码
					OcxCore.Session.ResetConfig("WebConnectMode","socket");//连接网站模式 socket flash http
					OcxCore.Session.ResetConfig("WebConnectUrl",data.CtiMonitorWsUrl);//连接网站地址
					OcxCore.Session.ResponsesCache.getWebsocketController().hearCheck.heatBeatCmdHandler = "com.callcenter.CTIAgent.web CtiMonitor_CH";//心跳检测处理类
					
					OcxCore.Session.setCookie(document.cookie);//cookie
					
					OcxCore.Session.clearBusySubStateList();//先清空置忙小状态列表
					if(data.BusySubStateList != undefined)
					{
						//添加置忙小状态列表
						for(var i=0;i<data.BusySubStateList.length;i++)
						{
							OcxCore.Session.addBusySubState(data.BusySubStateList[i].SubState,data.BusySubStateList[i].SubStateName);
						}
					}
					
					showSeatMode = data.ShowSeatMode != undefined ? data.ShowSeatMode : 1 ;//如何显示技能下的坐席，1显示技能下的坐席并集，2 显示交集
					
					//始始化
					OcxCore.Session.InitService();
					
					OcxCore.Session.StartHeartBeat();
					
					
					/* //开始队列监控并加载队列列表和坐席列表
					//windowload();
					var postData = {
						SessionId:OcxCore.Session.getSessionId(),
						UserName:OcxCore.Session.getUserName(),
						CompanyId:OcxCore.Session.getCompanyId()
					};
					
					//加载监控配置信息
					CtiMonitorCommandFun.CommonActionWS("LoadMonitorInfo","", postData,function(data1){
			    		OcxCore.Utility.ShowLoading(false);
			    		
			    		OcxCore.Log.info("加载监控配置信息:"+OcxCore.Utility.RenderJson(data1));
			    		//加载队列列表和坐席列表
			    		windowload();
			    	},function(ex){
			    		OcxCore.Utility.ShowLoading(false);
			    		if(ex.Message != undefined && ex.Message != "") OcxCore.Utility.ShowTip(ex.Message, 1);
			    	}); */
				});
			}
			else
			{
				alert("初始化队列监控时未找到父窗口的loadCtiMonitorUserInfo方法！");
			}
		}
	    //停止队列监控
	    function stopQueueMonitor()
	    {
	    	if(OcxCore.Session.ResponsesCache.IsRunning())
	    	{
	    		var postData = {};
	    		postData.CompanyId = OcxCore.Session.getCompanyId();
	   		    //发送停止监控命令
	   			CtiMonitorCommandFun.CommonActionWS("CommonAction","StopQueueMonitor", postData,null,null);
	    	}
	    }
		//加载效果
		function Loading(bool, text,time)
        {
			OcxCore.DialogUtil.Loading(bool, text,time);
        }
	    //加载队列监控表格
	    function GetQueueMonitorGrid() {
	    	/* var queueData = [
	    	   {"groupId":1,"groupName":"投诉组","idleCount":0,"enqueueCount":5,"maxWaitTime":180,"callInCount":33,"answerCount":22,"lostCallCount":11,"throughRate":"66.66%"},
	    	   {"groupId":2,"groupName":"咨询组","idleCount":0,"enqueueCount":2,"maxWaitTime":180,"callInCount":33,"answerCount":22,"lostCallCount":11,"throughRate":"66.66%"},
	    	   {"groupId":3,"groupName":"VIP组","idleCount":0,"enqueueCount":0,"maxWaitTime":180,"callInCount":33,"answerCount":22,"lostCallCount":11,"throughRate":"66.66%"}
	    	]; */
	        $("#queueGridTable").jqGrid({
	        	datatype:"local",
	        	/* data:queueData, */
	            height: $(window).height() - 183,
	            autowidth: true,
	            colModel: [
					{ label: "队列编号", name: "groupId", index: "groupId",width : 55,align:"center",key:true},
	                { label: "队列名称", name: "groupName",index: "groupName", width: 140},
	                { label: "空闲坐席数", name: "idleCount",index: "idleCount", width: 70,align:"center",
						formatter : function(cellvalue,options, rowObject) {
							
							//根据预警规则配置获取级别样式
			        	    var levelClass = getLevelClassByWarningRule("9",cellvalue);
							var sStr = "<span item='9' class='label WarningItem9 "+levelClass+"' title='空闲坐席数' style='width:45px;'>"+cellvalue+"</span>";
							return sStr;
						}
	                },
	                { label: "签入坐席数", name: "totalSeat",index: "totalSeat", width: 70,align:"center",
						formatter : function(cellvalue,options, rowObject) {
							
							//根据预警规则配置获取级别样式
			        	    var levelClass = getLevelClassByWarningRule("10",cellvalue);
							var sStr = "<span item='10' class='label WarningItem10 "+levelClass+"' title='签入坐席数' style='width:45px;'>"+cellvalue+"</span>";
							return sStr;
						}
	                },
	                { label: "排队电话数", name: "enqueueCount",index: "enqueueCount", width: 65,align:"center",
						formatter : function(cellvalue,options, rowObject) {
							
							//根据预警规则配置获取级别样式
			        	    var levelClass = getLevelClassByWarningRule("11",cellvalue);
							var sStr = "<span item='11' class='label WarningItem11 "+levelClass+"' title='排队电话数' style='width:45px;'>"+cellvalue+"</span>";
							/* if(cellvalue > 5)
							{
								sStr = "<span class='label label-red' title='排队电话数' style='width:45px;'>"+cellvalue+"</span>";
							}
							else if(cellvalue > 3)
							{
								sStr = "<span class='label label-yellow' title='排队电话数' style='width:45px;'>"+cellvalue+"</span>";
							}
							else if(cellvalue > 0)
							{
								sStr = "<span class='label label-green' title='排队电话数' style='width:45px;'>"+cellvalue+"</span>";
							}
							else
							{
								sStr = "<span class='label label-normal' title='排队电话数' style='width:45px;'>"+cellvalue+"</span>";
							} */
							return sStr;
						}
	                },
	                { label: "最长等待时间", name: "maxWaitTime",index: "maxWaitTime", width: 100,
						/* formatter : function(cellvalue,options, rowObject) {
							return CCUI.utils.timeTransfer(cellvalue);
						} */
		                formatter : function(cellvalue,options, rowObject) {
							var sStr = "";
							if(rowObject.maxWaitTime != "" && rowObject.maxWaitTime > 0)
				            {
								//根据预警规则配置获取级别样式
				        	    var levelClass = getLevelClassByWarningRule("12",cellvalue);
								sStr += "<span item='12' class='label WarningItem12 "+levelClass+"' duration='"+rowObject.maxWaitTime+"' title='最长等待时间'  style='width:55px;'>" + CCUI.utils.timeTransfer(rowObject.maxWaitTime) + "</span>";
				            }else
				            {
				            	sStr += "<span item='12' class='label WarningItem12 label-level0' duration='' title='最长等待时间'  style='width:55px;'>" + "--:--:--" + "</span>";
				            }
							return sStr;
						}
	                },
	                { label: "进线量", name: "callInCount",index: "callInCount", width: 70,align:"center",
						formatter : function(cellvalue,options, rowObject) {
							
							//根据预警规则配置获取级别样式
			        	    var levelClass = getLevelClassByWarningRule("13",cellvalue);
							var sStr = "<span item='13' class='label WarningItem13 "+levelClass+"' title='进线量' style='width:45px;'>"+cellvalue+"</span>";
							return sStr;
						}
	                },
	                { label: "接听量", name: "answerCount",index: "answerCount", width: 70,align:"center",
						formatter : function(cellvalue,options, rowObject) {
							
							//根据预警规则配置获取级别样式
			        	    var levelClass = getLevelClassByWarningRule("14",cellvalue);
							var sStr = "<span item='14' class='label WarningItem14 "+levelClass+"' title='接听量' style='width:45px;'>"+cellvalue+"</span>";
							return sStr;
						}
	                },
	                { label: "呼损量", name: "lostCallCount",index: "lostCallCount", width: 80,align:"center",
						formatter : function(cellvalue,options, rowObject) {
							
							//根据预警规则配置获取级别样式
			        	    var levelClass = getLevelClassByWarningRule("15",cellvalue);
							var sStr = "<span item='15' class='label WarningItem15 "+levelClass+"' title='呼损量' style='width:45px;'>"+cellvalue+"</span>";
							return sStr;
						}
	                },
	                { label: "接通率", name: "answerRate",index: "answerRate", width: 100,align:"center",
						formatter : function(cellvalue,options, rowObject) {
							var answerRateStr = cellvalue > 0 ? (cellvalue*100).toFixed(2) + "%":"0.00%";//接通率
							//根据预警规则配置获取级别样式
			        	    var levelClass = getLevelClassByWarningRule("16",cellvalue);
							var sStr = "<span item='16' class='label WarningItem16 "+levelClass+"' title='接通率' style='width:45px;'>"+answerRateStr+"</span>";
							return sStr;
						}
	                },
	                { label: "呼损率", name: "lostRate",index: "lostRate", width: 100,align:"center",
						formatter : function(cellvalue,options, rowObject) {
							var lostRateStr = cellvalue > 0 ? (cellvalue*100).toFixed(2) + "%":"0.00%";//接通率
							//根据预警规则配置获取级别样式
			        	    var levelClass = getLevelClassByWarningRule("17",cellvalue);
							var sStr = "<span item='17' class='label WarningItem17 "+levelClass+"' title='呼损率' style='width:45px;'>"+lostRateStr+"</span>";
							return sStr;
						}
	                }
	            ],
	            viewrecords: true,
	            rowNum: 500,
	            rowList: [30, 50, 100, 500],
	            pager: false,
	            sortname: 'CreateDate',
	            sortorder: 'asc',
	            rownumbers: true,
	            shrinkToFit: false,
	            gridview: true
	        });
	        
	        //$("#gview_queueGridTable .jqgridNotdata").width($(".centerPanel").width() - 19);
	        
	        //$("#gview_queueGridTable .jqgridNotdata").hide();
	    }
	    
	    //坐席监控
	    function seatMonitorClickHandler()
	    {
	    	var winId = "seatMonitor"+OcxCore.Utility.GetUUID().replace(/-/g, "").toUpperCase();
    		var url = "SeatMonitor.html?CompanyId="+OcxCore.Session.getCompanyId();
	    	//1220*710
	    	var iWidth=$(window).width() - 10;//弹出窗口的宽度; 
	        var iHeight=$(window).height() - 10;//弹出窗口的高度; 
	        if(iWidth>1220)
	        {
	        	iWidth = 1220;
	        }
	        if(iHeight>710)
	        {
	        	iHeight = 710;
	        }
	    	//获得窗口的垂直位置 
	        var iTop = (window.screen.availHeight - 30 - iHeight) / 2; 
	        //获得窗口的水平位置 
	        var iLeft = (window.screen.availWidth - 10 - iWidth) / 2;
	        var singleWin = window.open(url, winId, "height="+iHeight+", width="+iWidth+", top="+iTop+", left="+iLeft+", toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no"); 
	    
	        seatMonitorWindows.put(winId,singleWin);
	    }
	    //排队监控
	    function callDataMonitorClickHandler()
	    {
	    	var winId = "callDataMonitor"+OcxCore.Utility.GetUUID().replace(/-/g, "").toUpperCase();
    		var url = "CallDataMonitor.html?CompanyId="+OcxCore.Session.getCompanyId();
	    	//1220*710
	    	var iWidth=$(window).width() - 10;//弹出窗口的宽度; 
	        var iHeight=$(window).height() - 10;//弹出窗口的高度; 
	        if(iWidth>1220)
	        {
	        	iWidth = 1220;
	        }
	        if(iHeight>710)
	        {
	        	iHeight = 710;
	        }
	    	//获得窗口的垂直位置 
	        var iTop = (window.screen.availHeight - 30 - iHeight) / 2; 
	        //获得窗口的水平位置 
	        var iLeft = (window.screen.availWidth - 10 - iWidth) / 2;
	        var singleWin = window.open(url, winId, "height="+iHeight+", width="+iWidth+", top="+iTop+", left="+iLeft+", toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no"); 
	    
	        seatMonitorWindows.put(winId,singleWin);
	    }
	    
	    //选择队列
	    function selectQueueClickHandler()
	   	{
	    	var selCount = 0;
	    	$(".sys_spec_text").html("");
	    	_QueueDatas.each(function(key,grp,index){
	    		var selStr = grp.selected != undefined && grp.selected == true ? "selected":"";
	    		var aSelStr = grp.selected != undefined && grp.selected == true ? "a_selected":"";
	    		if(grp.selected != undefined && grp.selected == true) selCount++;
	    		var grpHtml = "<li class='"+selStr+"'><a class='"+aSelStr+"' grpid='"+grp.groupId+"' grpname='"+grp.groupName+"' ><img src='../images/Icon16/group_gear.png'>"+grp.groupName+"</a><i></i></li>";
   				$(".sys_spec_text").append(grpHtml);
	        });
	    	if(selCount > 0 && selCount == _QueueDatas.size())
	    	{
	    		$("#CheckButton").attr('title', '反选');
	    		$("#CheckButton").text('反选');
	    		$("#CheckButton").attr('class', 'checkAllOn');
	    	}
	    	else
	    	{
	    		$("#CheckButton").attr('title', '全选');
	    		$("#CheckButton").text('全选');
	    		$("#CheckButton").attr('class', 'checkAllOff');
	    	}
	    	
	    	var artApi = art.dialog({
		        id: "dialog_selectQueue",
		        width: 600,
		        height: 375,
		        max: false,
		        lock: true,
		        resize:false,
		        opacity: 0.3,
		        title: "选择队列",
		        extendDrag: true,
		        content:$("#divSelectQueue")[0],
		        ok: function () {
					$("#queueGridTable").jqGrid('clearGridData');//清空队列列表
		            $('.sys_spec_text a').each(function () { 
		            	var grpId = $(this).attr('grpid');
		            	if($(this).hasClass("a_selected"))
		            	{
			            	if(_QueueDatas.containsKey(grpId))
		    	        	{
		            			var grpData = _QueueDatas.get(grpId);
		            			grpData.selected = true;
		            			$("#queueGridTable").jqGrid("addRowData", grpData.groupId+"", grpData, "last");
		    	        	}
		            	}
		            	else
		            	{
		            		if(_QueueDatas.containsKey(grpId))
		    	        	{
		            			var grpData = _QueueDatas.get(grpId);
		            			grpData.selected = false;
		    	        	}
		            	}
		            });
		            //刷新队列统计信息
			        refreshQueueCountInfo(); 
			        //刷新坐席统计信息
				    refreshSeatCountInfo();
			        
		            return true;
		        },
		        cancel: true
		    });
	   	}
	    /**
		 * 隐藏行
		 */
		function hideRow(rowId){
			$("#queueGridTable").setRowData(rowId,null,{display: 'none'});
		}
		/**
		*显示行
		*/
		function showRow(rowId){
			$("#queueGridTable").setRowData(rowId,null,{display: 'block'});
		}
	    //搜索
	    function btn_Search() {
	        var keywords = $("#keywords").val();
	        var seatState = $("#SeatState").val();
	        if (keywords != "" || seatState != "") {
	        	var showSeats = null;
	        	if(keywords != "")
	        	{
	        		showSeats = $(".UserCard")
                     .hide()
                     .filter(":contains('" + (keywords) + "')");
                     if(seatState != "")
                     {
                     	var stateName = openerW.OcxCore.Enums.GetName(openerW.OcxCore.Enums.CTIAgentStatusFlag,seatState);
		        		showSeats = showSeats.filter(":contains('" + (stateName) + "')");
                     }
                     showSeats.show();
	        	}else
	        	{
	        		var stateName = openerW.OcxCore.Enums.GetName(openerW.OcxCore.Enums.CTIAgentStatusFlag,seatState);
	        		showSeats = $(".UserCard")
                     .hide()
                     .filter(":contains('" + (stateName) + "')")
                     .show();
	        	}
                    
            } else {
                $(".UserCard").show();
            }
            
            $("#grid_View .selected").removeClass("selected");
	    }
	       
	    //刷新
	    function windowload(selectAllGrp) {
	    	if(OcxCore.Session.getCompanyId() == null || OcxCore.Session.getCompanyId() == "")
			{
				return;
			}
	    	window.setTimeout(function () {
	    		//临时代码，默认监控第一个技能
	    		var postData = {};
	    		postData.CompanyId = OcxCore.Session.getCompanyId();
	    		//清空显示信息
	    	    clearShowInfo();
	   		    //监控窗口加载完成后发送开始监控命令
	   			CtiMonitorCommandFun.CommonActionWS("CommonAction","BeginQueueMonitor", postData,function(data){
		    		OcxCore.Utility.ShowLoading(false);
		    		var oldQueueDatas = _QueueDatas;//原队列列表
		    		_QueueDatas = new OcxCore.Map();//新队列列表
		    		if(data.Result == true)
		    		{
		    			if(data.QueueData != undefined && data.QueueData.length>0)
		    			{
		    				for (var i = 0; i < data.QueueData.length; i++) {
		    					var grp = data.QueueData[i];
		            			if(oldQueueDatas.containsKey(grp.groupId))
		        	        	{
		            				var simpleGrp = oldQueueDatas.get(grp.groupId);
		            				grp.selected = simpleGrp != null && simpleGrp.selected == true ? true : false;
		        	        	}
		            			else
		            			{
		            				grp.selected = selectAllGrp != undefined && selectAllGrp == true ? true : false;
		            			}
			    			}
			    			LoadGroupViewList(data.QueueData);
		    			}
		                LoadSeatViewList(data.SeatData);
		    		}
		    	},function(ex){
		    		OcxCore.Utility.ShowLoading(false);
		    		if(ex.Message != undefined && ex.Message != "") OcxCore.Utility.ShowTip(ex.Message, 1);
		    	});
	   			
	        }, 200);
	    	
	    	if(changeDurationInterval !=null) clearInterval(changeDurationInterval);
        	changeDurationInterval = setInterval("changeDuration()", 1000);//1秒更新一次
	    }
	    var changeDurationInterval = null;
	    function changeDuration()
	    {
	    	_SeatDatas.each(function(seatKey,seatItem,seatIndex){
	    		if(seatItem.ChangeStateDuration != null && seatItem.ChangeStateDuration != "")
	    			seatItem.ChangeStateDuration++;
	        });
	    	var showQueueDatas = $("#queueGrid_Panel").find(".WarningItem12");
	    	showQueueDatas.each(function(){
	    		if($(this).attr("duration") != "")
	            {
	            	var dseconds = parseInt($(this).attr("duration"))+1;
	            	$(this).attr("duration",dseconds).html(CCUI.utils.timeTransfer(dseconds));
	            	
	            	//根据预警规则配置获取级别样式
	        	    var levelClass = getLevelClassByWarningRule("12",dseconds);
	        	    $(this).attr("class","label WarningItem12 "+levelClass);
	            }
	    		else
	            {
	            	$(this).attr("class","label WarningItem12 label-level0").html('--:--:--');
	            }
	    	});
	    	_QueueDatas.each(function(queueKey,queueItem,queueIndex){
	    		if(queueItem.maxWaitTime != null && queueItem.maxWaitTime != "" && queueItem.maxWaitTime > 0)
	    			queueItem.maxWaitTime++;
	        });
	    	_SeatDatas.each(function(seatKey,seatItem,seatIndex){
	    		if(seatItem.ChangeStateDuration != null && seatItem.ChangeStateDuration != "")
	    			seatItem.ChangeStateDuration++;
	        });
	    	var lblMaxWaitTime = $("#lbl_maxWaitTime");
	    	if(lblMaxWaitTime.attr("duration") != "")
            {
            	var dseconds = parseInt(lblMaxWaitTime.attr("duration"))+1;
            	lblMaxWaitTime.attr("duration",dseconds).html(CCUI.utils.timeTransfer(dseconds));
            	
            	//根据预警规则配置获取级别样式
        	    var levelClass = getLevelClassByWarningRule("20",dseconds);
        	    lblMaxWaitTime.attr("class","label WarningItem20 "+levelClass);
        	    
            	/* if(dseconds > 90)
				{
            		lblMaxWaitTime.attr("class","label WarningItem20 label-red");
				}
				else if(dseconds > 60)
				{
					lblMaxWaitTime.attr("class","label WarningItem20 label-yellow");
				}
				else if(dseconds > 30)
				{
					lblMaxWaitTime.attr("class","label WarningItem20 label-green");
				}
				else
				{
					lblMaxWaitTime.attr("class","label WarningItem20 label-normal");
				} */
            }
    		else
            {
    			lblMaxWaitTime.attr("class","label WarningItem20 label-level0").html('--:--:--');
            }
	    	
	    	/* var showSeats = $("#seatGrid_Panel").find(".ChangeStateDuration");
	    	showSeats.each(function(){
	    		if($(this).attr("duration") != "")
	            {
	            	var dseconds = parseInt($(this).attr("duration"))+1;
	            	$(this).attr("duration",dseconds).html(CCUI.utils.timeTransfer(dseconds));
	            	
	            	if(dseconds > 600)
					{
	            		$(this).attr("class","label ChangeStateDuration label-red");
					}
					else if(dseconds > 400)
					{
						$(this).attr("class","label ChangeStateDuration label-yellow");
					}
					else if(dseconds > 200)
					{
						$(this).attr("class","label ChangeStateDuration label-green");
					}
					else
					{
						$(this).attr("class","label ChangeStateDuration label-normal");
					}
	            }else
	            {
	            	$(this).attr("class","label ChangeStateDuration label-normal").html('--:--:--');
	            }
	    	}); */
	    }
	    //根据预警规则配置获取级别样式
	    function getLevelClassByWarningRule(warningItem,itemValue)
	    {
	    	var levelClass = "label-level0";
	    	if(warningRuleData.containsKey(warningItem))
        	{
        		var curRuleDataArr = warningRuleData.get(warningItem);
        		for(var i=0;i<curRuleDataArr.length;i++)
        		{
        			var ruleItem = curRuleDataArr[i];
        			if(ruleItem.operation == "大于等于" && ruleItem.paramValue != "" && itemValue >= ruleItem.paramValue)
        			{
        				levelClass = "label-level"+ruleItem.warningLevel;
        			}
        			else if(ruleItem.operation == "小于等于" && ruleItem.paramValue != "" && itemValue <= ruleItem.paramValue)
        			{
        				levelClass = "label-level"+ruleItem.warningLevel;
        			}
        		}
        	}
	    	return levelClass;
	    }
	    /*视图begin=========================================================================*/
	    
	    //加载坐席视图
	    function LoadSeatViewList(data) {
	        for (var i = 0; i < data.length; i++) {
	        	var isContainSeat = false;
	        	if(_SeatDatas.containsKey(data[i].JobNum+""))
	        	{
	        		isContainSeat = true;
	        		if(data[i].State == OcxCore.Enums.CTIAgentStatusFlag.STATE_OFFLINE.getIndex())
	        		{
	        			_SeatDatas.remove(data[i].JobNum+"");
	        		}
	        		else
	        		{
	        			_SeatDatas.put(data[i].JobNum+"", data[i]);
	        		}
	        	}else
	        	{
	        		if(data[i].State != OcxCore.Enums.CTIAgentStatusFlag.STATE_OFFLINE.getIndex() && data[i].JobNum != null)
	        		{
						_SeatDatas.put(data[i].JobNum+"", data[i]);
	        		}
	        	}
	        }
	      	//刷新坐席统计信息
		    refreshSeatCountInfo();
        	
        	
	        //$("#CenterTitle").html(GroupName);
	        //$("#lblTotal").text($("#grid_View .UserCard").size());
	        
	        //btn_Search();
	    }
	    
	    //加载队列视图
	    function LoadGroupViewList(data) {
	        for (var i = 0; i < data.length; i++) {
	        	var isContainQueue = false;
	        	if(_QueueDatas.containsKey(data[i].groupId+""))
	        	{
	        		isContainQueue = true;
	        		var oldData = _QueueDatas.get(data[i].groupId+"");
	        		if(oldData != null && oldData.selected != undefined)
	        		{
	        			data[i].selected = oldData.selected;
	        		}
	        		else
	        		{
	        			data[i].selected = data[i].selected != undefined ? data[i].selected:false;
	        		}
        			_QueueDatas.put(data[i].groupId+"", data[i]);
        			if(data[i].selected)
	        		{
        				$("#queueGridTable").jqGrid("setRowData", data[i].groupId+"", data[i]);
	        		}
	        	}else
	        	{
	        		data[i].selected = data[i].selected != undefined ? data[i].selected:false;
	        		_QueueDatas.put(data[i].groupId+"", data[i]);
	        		if(data[i].selected)
	        		{
	        			$("#queueGridTable").jqGrid("addRowData", data[i].groupId+"", data[i], "last");
	        		}
	        	}
	        }
	        //刷新队列统计信息
	        refreshQueueCountInfo();
			
			
	        //$("#CenterTitle").html(GroupName);
	        //$("#lblTotal").text($("#grid_View .UserCard").size());
	        
	        //btn_Search();
	    }
	    
	    //加载预警
	    function LoadWarningRuleList(data) {
	        for (var warningRule in data) {
	        	if(warningRuleData.containsKey(warningRule+""))
	        	{
	        		warningRuleData.put(warningRule+"", data[warningRule]);
	        	}else
	        	{
	        		warningRuleData.put(warningRule+"", data[warningRule]);
	        	}
	        }
	    }
	    //刷新队列统计信息
	    function refreshQueueCountInfo()
	    {
	    	var queueCount = 0;//选择队列数
	        var enqueueCount = 0;//排队电话数
	        var maxWaitTime = 0;//最大等待时长
	        var avgTalkTime = 0;//平均通话时长
	        var callInCount = 0;//进线量
	        var answerCount = 0;//接听量
	        var lostCallCount = 0;//呼损量
	        var answerRate = "";//接听率
	        var lostRate = "";//呼损率
	        _QueueDatas.each(function(key,queueItem,index){
	        	if(queueItem.selected)
	        	{
	        		queueCount++;
	        		enqueueCount = enqueueCount + queueItem.enqueueCount;
	        		if(queueItem.maxWaitTime != null && queueItem.maxWaitTime != "" && queueItem.maxWaitTime > maxWaitTime)
	        		{
	        			maxWaitTime = queueItem.maxWaitTime;
	        		}
	        		callInCount = callInCount + queueItem.callInCount;
	        		answerCount = answerCount + queueItem.answerCount;
	        		lostCallCount = lostCallCount + queueItem.lostCallCount;
	        	}	
	        });
	        //answerRate = (callInCount - enqueueCount) > 0 ? ((Math.round(answerCount / (callInCount - enqueueCount) * 10000) / 100.00).toFixed(2) + "%"):"0.00%";//接通率
			//lostRate = (callInCount - enqueueCount) > 0 ? ((Math.round(lostCallCount / (callInCount - enqueueCount) * 10000) / 100.00).toFixed(2) + "%"):"0.00%";//呼损率
			
			answerRate = (callInCount - enqueueCount) > 0 ? (Math.round(answerCount / (callInCount - enqueueCount) * 10000) / 10000.00):0;//接通率
			lostRate = (callInCount - enqueueCount) > 0 ? (Math.round(lostCallCount / (callInCount - enqueueCount) * 10000) / 10000.00):0;//呼损率
			
			$("#lblQueueCount").text(queueCount);
        	//根据预警规则配置获取级别样式
    	    var levelClass = getLevelClassByWarningRule("19",enqueueCount);
    	    $("#lbl_enqueueCount").attr("class","label WarningItem WarningItem19 "+levelClass).html(enqueueCount);
			
        	if(maxWaitTime > 0)
        	{
        		//根据预警规则配置获取级别样式
        	    var levelClass = getLevelClassByWarningRule("20",maxWaitTime);
        		$("#lbl_maxWaitTime").attr("duration",maxWaitTime).attr("class","label WarningItem20 "+levelClass).html(CCUI.utils.timeTransfer(maxWaitTime));
        	}
        	else
        	{
        		$("#lbl_maxWaitTime").attr("duration","").attr("class","label WarningItem20 label-level0").html('--:--:--');
        	}	
        	//$("#lbl_maxWaitTime").html(CCUI.utils.timeTransfer(maxWaitTime));
        	/* if(avgTalkTime > 0)
        	{
        		//根据预警规则配置获取级别样式
        	    var levelClass = getLevelClassByWarningRule("21",avgTalkTime);
        		$("#lbl_avgTalkTime").attr("class","label WarningItem21 "+levelClass).html(CCUI.utils.timeTransfer(avgTalkTime));
        	}
        	else
        	{
        		$("#lbl_avgTalkTime").attr("class","label WarningItem21 label-level0").html('--:--:--');
        	} */
        	levelClass = getLevelClassByWarningRule("22",callInCount);
    	    $("#lbl_callInCount").attr("class","label WarningItem WarningItem22 "+levelClass).html(callInCount);
        	levelClass = getLevelClassByWarningRule("23",answerCount);
    	    $("#lbl_answerCount").attr("class","label WarningItem WarningItem23 "+levelClass).html(answerCount);
        	levelClass = getLevelClassByWarningRule("24",lostCallCount);
    	    $("#lbl_lostCallCount").attr("class","label WarningItem WarningItem24 "+levelClass).html(lostCallCount);
    	    var answerRateStr = answerRate > 0 ? (answerRate*100).toFixed(2) + "%":"0.00%";//接通率
    	    levelClass = getLevelClassByWarningRule("25",answerRate);
    	    $("#lbl_answerRate").attr("class","label WarningItem WarningItem25 "+levelClass).html(answerRateStr);
    	    var lostRateStr = lostRate > 0 ? (lostRate*100).toFixed(2) + "%":"0.00%";//接通率
    	    levelClass = getLevelClassByWarningRule("26",lostRate);
    	    $("#lbl_lostRate").attr("class","label WarningItem WarningItem26 "+levelClass).html(lostRateStr);
	    }
	    
	    //刷新坐席统计信息
	    function refreshSeatCountInfo()
	    {
	    	var idleCount = 0;//空闲数
	        var seatCount= 0;//签入坐席数
	        var selQueueIds = new Array();
	        _QueueDatas.each(function(queueKey,queueItem,index){
	        	if(queueItem.selected)
	        	{
	        		selQueueIds.push(queueItem.groupId);
	        	}
	        });
	        if(selQueueIds.length>0)
	        {
	        	_SeatDatas.each(function(seatKey,seatItem,seatIndex){
	        		var isInSelGroup = false;
	        		if(isInGroup(selQueueIds,seatItem.GroupIds))
		        	{
        				isInSelGroup = true;
		        	}
		        	if(isInSelGroup)
		        	{
		        		seatCount++;
		        		if(seatItem.State == 1) idleCount++;
		        	}
		        });
	        }
			//空闲坐席数
			var levelClass = getLevelClassByWarningRule("18",idleCount);
    	    $("#lbl_idleCount").attr("class","label WarningItem WarningItem18 "+levelClass).html(idleCount);
    	    levelClass = getLevelClassByWarningRule("41",seatCount);
    	    $("#lbl_seatCount").attr("class","label WarningItem WarningItem41 "+levelClass).html(seatCount);
	    }
	    //清空显示信息
	    function clearShowInfo()
	    {
	    	//_QueueDatas.clear();
    		_SeatDatas.clear();
    		$("#lblQueueCount").text("0");
    		
        	$("#lbl_idleCount").attr("class","label WarningItem WarningItem18 label-level0").html("0");
        	$("#lbl_enqueueCount").attr("class","label WarningItem WarningItem19 label-level0").html("0");
        	//$("#lbl_maxWaitTime").html("");
        	$("#lbl_maxWaitTime").attr("duration","").attr("class","label WarningItem WarningItem20 label-level0").html("--:--:--");
        	//$("#lbl_avgTalkTime").attr("class","label WarningItem WarningItem21 label-level0").html("");
        	$("#lbl_seatCount").attr("class","label WarningItem WarningItem41 label-level0").html("");
        	$("#lbl_callInCount").attr("class","label WarningItem WarningItem22 label-level0").text("0");
        	$("#lbl_answerCount").attr("class","label WarningItem WarningItem23 label-level0").text("0");
        	$("#lbl_lostCallCount").attr("class","label WarningItem WarningItem24 label-level0").text("0");
        	$("#lbl_answerRate").attr("class","label WarningItem WarningItem25 label-level0").text("");
        	$("#lbl_lostRate").attr("class","label WarningItem WarningItem26 label-level0").text("");
	        
    		$("#queueGridTable").jqGrid('clearGridData');//清空队列列表
	    }
	    /**
	    *是否包含指定队列
	    *
	    *@param selGroupIds 当前选中的技能数组  
	    *@param seatGroupIds 坐席归属的技能数组
	    */
	    function isInGroup(selGroupIds,seatGroupIds)
	    {
	    	var isHasGroupId = false;
	    	var matchCount = 0;
    		if(selGroupIds != undefined && selGroupIds.length>0)
    		{
    			for(var j=0;j<selGroupIds.length;j++)
    			{
    				var isInG = false;
    				for(var k=0;k<seatGroupIds.length;k++)
        			{
    					if(selGroupIds[j] == seatGroupIds[k])
        				{
    						isInG = true;
        					break;
        				}
        			}
    				if(isInG)
    				{
    					matchCount++;
    				}
    			}
    			if(showSeatMode == 1 && matchCount>0)
    			{
    				isHasGroupId = true;
    			}
    			else if(matchCount>0 && matchCount == selGroupIds.length)
    			{
    				isHasGroupId = true;
    			}
    		}
    		return isHasGroupId;
	    }
	    /*视图end=========================================================================*/
	    //通知
    function mainPageNotify(cmd, data)
	{
    	OcxCore.Log.info("cmd="+cmd+" ,  data="+OcxCore.Utility.RenderJson(data));
        if (cmd == "SEATSTATE_NOTIFY")//监控坐席状态通知
        {
            var seats = data.Data;//[{"Seat":1001,"State":1,"JobNum":"10000","Name":"宾客","Gender":"男","ChangeStateDuration":600},{"Seat":1002,"State":2,"JobNum":"10001","Name":"吴珏妹","Gender":"女","ChangeStateDuration":800},{"Seat":1003,"State":3,"JobNum":"10002","Name":"徐晓悦","Gender":"男","ChangeStateDuration":""}];
            LoadSeatViewList(seats);
        }
        else if (cmd == "GROUPSTATE_NOTIFY")//监控技能状态通知
        {
            var groups = data.Data;
            LoadGroupViewList(groups);
        }
        
        //分发到监控窗口
        seatMonitorWindows.each(function(key,value,index){
        	try
        	{
        		var singleWin = value;
            	if(singleWin && singleWin.open && !singleWin.closed)
                { 
            		singleWin.Notify(cmd, data);
                }
        	}
        	catch(e)
        	{
        		
        	}
        });
        
        /* else if (cmd == "GROUPWAITCOUNT_NOTIFY")//技能排队等待数量通知
        {
        	if(GroupId != null && GroupId == data.GroupId)
			{
				var waitCount = data.WaitCount || 0;
            	$("#lblWaitCount").text(waitCount);
			}
        } */
        /* else if(cmd == "CurrentUserStateChanged")
        {
        	if(!openerW.OcxCore.Session.IsCheckin())
        	{
        		$("#grid_View").html("");
        		_SeatDatas.clear();
        		
        		closeThisWindow();//关闭窗口
        	}
         	else if(openerW.OcxCore.Session.GetUserInfo() != null && openerW.OcxCore.Session.GetUserInfo().CTIMonitorStatus == openerW.OcxCore.Enums.CTIMonitorStatusFlag.INITSYSTEM.getIndex())
        	{
        		if (!!$(this).hasClass("selected")) {
                    $(this).removeClass("selected");
                } else {
                	$("#grid_View .selected").removeClass("selected");
                    $(this).addClass("selected");
                }
                var seatExtNum = $(this).attr("id").toString().replace("seat_","");
                changeButtonState($(this),_SeatDatas.get(seatExtNum));
        	}else
        	{
        		var seatExtNum = $(this).attr("id").toString().replace("seat_","");
                changeButtonState($(this),_SeatDatas.get(seatExtNum));
        	} 
        }else if(cmd == "MonitorOptionRes")
        {
        	openerW.OcxCore.Utility.ShowLoading(false);
        	if(data.Result == true)
        	{
        		openerW.OcxCore.Session.getCTIAgentData().setCTIMonitorStatus(data.CTIMonitorStatus);
        		var seat = _SeatDatas.get(data.CTIMonitorExtNumber);
        		seat.MonitorButton = data.MonitorButton;
        		_SeatDatas.put(data.CTIMonitorExtNumber+"", seat);
      			var seatObj = $("#"+"seat_"+data.CTIMonitorExtNumber);
     			if(openerW.OcxCore.Session.getCTIAgentData().getCTIMonitorStatus() == openerW.OcxCore.Enums.CTIMonitorStatusFlag.INITSYSTEM.getIndex())
     			{
     				openerW.OcxCore.Session.getCTIAgentData().setCTIMonitorExtNumber("");
     			}else
     			{
     				openerW.OcxCore.Session.getCTIAgentData().setCTIMonitorExtNumber(data.CTIMonitorExtNumber);
     			}
     			
     			if(data.CloseMonitorDialog != undefined && data.CloseMonitorDialog == true)
     			{
     				closeThisWindow();//关闭窗口
     			}
        	}
        } */
	}

	function changeRightMenuState(seat,currSeatData,menu1)
	{
		if(seat != null && !!seat.hasClass("selected"))
		{
			var seatExtNum = seat.attr("id").toString().replace("seat_","");
			var seatState = seat.attr("state").toString();
			if(currSeatData != null && currSeatData.MonitorButton != undefined)
			{
				for (var i in currSeatData.MonitorButton)
				{
					if(currSeatData.MonitorButton[i] == false)
					{
						$("li[cmd='"+i+"']", menu1).remove();
					}
				}
			}else
			{
				$("li", menu1).remove();
			}
		}else
		{
			$("li", menu1).remove();
		}
	}
	
	//关闭监控窗口
	function closeThisWindow()
	{
        window.close();//关闭窗口
	}
	//如何显示技能下的坐席，1显示技能下的坐席并集，2 显示交集
	function getShowSeatMode(){
		return showSeatMode;
	}
	function setShowSeatMode(modeValue){
		showSeatMode == modeValue;
	}
	</script>
	<style type="text/css">
	.nui_buttons button{margin-left:10px;}
	</style>
	
	
	<style type="text/css">
		.form .formValue{ padding-left:3px;}
		.ui-widget-content-altclass{background:#fff;}
		.ui-jqgrid .ui-jqgrid-btable {border-right: 1px solid #ccc;}
		.ui-jqgrid tr.jqgrow td {height: 32px;border-bottom:1px solid #ccc;border-right:none;}
		.ui-state-highlight, .ui-widget-content .ui-state-highlight, .ui-widget-header .ui-state-highlight  {background: #e4e4e4;color: #000000;}
		
		.sys_spec_text li{height: 33px;}
		.sys_spec_text li a{height: 29px;line-height: 29px;}
		
		.label {
		    display: block;
		    padding: .2em .6em .3em;
		    font-size: 75%;
		    /* font-weight: 700; */
		    line-height: 1;
		    /* color: #fff; */
		    text-align: center;
		    white-space: nowrap;
		    vertical-align: baseline;
		    border-radius: .25em;
		}
		.label-red {
		    background: #D92D29;
		    color: #fff;
		}
		.label-orange {
		    background: #FF9702;
		    color: #000;
		}
		.label-yellow {
		    background: #FAF81D;
		    color: #000;
		}
		.label-blue {
		    background: #587ff1;
		    color: #fff;
		}
		.label-normal {
		    color: #000;
		}
		
		.label-level4 {
		    background: #D92D29;
		    color: #fff;
		}
		.label-level3 {
		    background: #FF9702;
		    color: #000;
		}
		.label-level2 {
		    background: #FAF81D;
		    color: #000;
		}
		.label-level1 {
		    background: #587ff1;
		    color: #fff;
		}
		.label-level0 {
		    color: #000;
		}
	</style>
  </head>
  <body>
     <div class="tools_bar" style="border-top: none; margin-bottom: 0px;">
     	<div class="PartialButton">
      		<a title="刷新" class="tools_btn" id="cc-replace" onclick="windowload()"><span><b style='background: url("../images/Icon16/arrow_refresh.png") no-repeat 1px 4px;'>刷新</b></span></a>
      		<a title="预警设置" class="tools_btn" id="cc-edit" onclick="btn_edit()" style="display:none;"><span><b style='background: url("../images/Icon16/cog.png") no-repeat 1px 4px;'>预警设置</b></span></a>
      		<a title="坐席监控" class="tools_btn" id="cc-seatMonitor" onclick="seatMonitorClickHandler()"><span><b style='background: url("../images/Icon16/monitor_window_flow.png") no-repeat 1px 4px;'>坐席监控</b></span></a>
      		<a title="呼叫排队监控" class="tools_btn" id="cc-callDataMonitor" onclick="callDataMonitorClickHandler()"><span><b style='background: url("../images/Icon16/monitor_window_flow.png") no-repeat 1px 4px;'>呼叫排队监控</b></span></a>
      		<a title="选择队列" class="tools_btn" id="cc-selectQueue" onclick="selectQueueClickHandler()"><span><b style='background: url("../images/Icon16/outlook_new_meeting.png") no-repeat 1px 4px;'>选择队列</b></span></a>
     	</div>
	</div>
	<div id="queueTb_Panel">
        <table id="queueTb" class="form">
	        <tr>
	            <th class="formTitle">空闲坐席数：</th>
	            <td class="formValue">
	                <span id="lbl_idleCount" class="label WarningItem WarningItem18 label-level0" style='width:45px;'>0</span>
	            </td>
	            <th class="formTitle">排队电话数：</th>
	            <td class="formValue">
	                <span id="lbl_enqueueCount" class="label WarningItem WarningItem19 label-level0" style='width:45px;'>0</span>
	            </td>
	            <th class="formTitle">最长等待时间：
	            </th>
	            <td class="formValue">
	                <span id="lbl_maxWaitTime" class='label WarningItem WarningItem20 label-level0' duration=''  style='width:55px;'></span>
	            </td>
	        </tr>
	        <tr>
	            <!-- <th class="formTitle">平均通话时长：
	            </th>
	            <td class="formValue">
	                <span id="lbl_avgTalkTime" class='label WarningItem WarningItem21 label-level0' duration=''  style='width:55px;'></span>
	            </td> -->
	            <th class="formTitle">签入坐席数：</th>
	            <td class="formValue">
	                <span id="lbl_seatCount" class="label WarningItem WarningItem41 label-level0" style='width:45px;'>0</span>
	            </td>
	            <th class="formTitle">进线量：</th>
	            <td class="formValue">
	                <span id="lbl_callInCount" class="label WarningItem WarningItem22 label-level0" style='width:45px;'>0</span>
	            </td>
	            <th class="formTitle">接听量：</th>
	            <td class="formValue">
	                <span id="lbl_answerCount" class="label WarningItem WarningItem23 label-level0" style='width:45px;'>0</span>
	            </td>
	        </tr>
	        <tr>
	            <th class="formTitle">呼损量：</th>
	            <td class="formValue">
	                <span id="lbl_lostCallCount" class="label WarningItem WarningItem24 label-level0" style='width:45px;'>0</span>
	            </td>
	            <th class="formTitle">接通率：</th>
	            <td class="formValue">
	                <span id="lbl_answerRate" class="label WarningItem WarningItem25 label-level0" style='width:45px;'></span>
	            </td>
	            <th class="formTitle">呼损率：</th>
	            <td class="formValue">
	                <span id="lbl_lostRate" class="label WarningItem WarningItem26 label-level0" style='width:45px;'></span>
	            </td>
	        </tr>
	    </table>
    </div>
	<div class="btnbartitle">
         <div>
         	队列监控（队列数：<label id="lblQueueCount" style="color:red;" >0</label>）
         </div>
     </div>
     <div id="queueGrid_Panel">
         <table id="queueGridTable"></table>
     </div>
<div style="display:none;">
	<div id="divSelectQueue" class="border" style="margin: 1px;width:600px;height:375px;">
	    <div class="btnbartitle">
	        <div style="float: left">
	        </div>
	        <div style="float: right">
	            <label id="CheckButton" class="checkAllOff" title="全选">全选</label>
	        </div>
	    </div>
	    <div id="SeatGroupList" style="height: 345px;overflow: auto;">
	        <ul class="sys_spec_text">
	        	<!-- <li class="selected"><a class="a_selected" grpId="1" grpName="技能1" ><img src="../images/Icon16/group_gear.png">技能1</a><i></i></li>
	        	<li class="selected"><a class="a_selected" grpId="2" grpName="技能2" ><img src="../images/Icon16/group_gear.png">技能2</a><i></i></li>
	        	<li class=""><a class="" grpId="3" grpName="技能3" ><img src="../images/Icon16/group_gear.png">技能3</a><i></i></li> -->
	        </ul>
	    </div>
	</div>
</div>
  </body>
</html>